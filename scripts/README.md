# Primitive Scripts

This directory contains utility scripts for batch processing images and generating HTML galleries of primitive art results.

## Overview

The scripts work together to provide a complete workflow:
1. **`process.py`** - Batch processes images with multiple primitive parameters
2. **`html.py`** - Generates HTML galleries to compare results

## process.py - Batch Image Processor

### Purpose
Automatically processes entire folders of images with the primitive algorithm using multiple parameter combinations in parallel.

### Features
- **Parallel processing** - Uses multiple worker threads for efficiency
- **Parameter matrix** - Tests multiple combinations of shapes, alpha, and modes
- **Resume capability** - Skips already processed images
- **Organized output** - Creates structured directory hierarchy

### Usage
```bash
python scripts/process.py input_folder/ output_folder/
```

### Default Configuration
```python
nlist = [500]        # Number of shapes to generate
alist = [128]        # Alpha transparency values
mlist = [0, 1, 3, 5] # Shape modes to test
nworkers = 4         # Parallel worker threads
```

### Shape Modes Tested
- **Mode 0**: Mixed/combo primitives
- **Mode 1**: Triangles only
- **Mode 3**: Ellipses only  
- **Mode 5**: Rotated rectangles only

### Fixed Parameters
- **Resolution**: `-r 128` (resize input to 128px max dimension)
- **Size**: `-s 512` (output image size 512px)

### Output Structure
```
output_folder/
├── image1/
│   ├── 0.500.png    # 500 mixed shapes
│   ├── 1.500.png    # 500 triangles
│   ├── 3.500.png    # 500 ellipses
│   └── 5.500.png    # 500 rotated rectangles
├── image2/
│   ├── 0.500.png
│   ├── 1.500.png
│   ├── 3.500.png
│   └── 5.500.png
└── ...
```

### Input Requirements
- Supports `.jpg`, `.jpeg`, `.png` image formats
- Images should be placed in a single input directory
- No subdirectory processing (flat structure only)

### Performance Notes
- **4 concurrent processes** by default (adjustable via `nworkers`)
- **Smart resuming** - Won't reprocess existing output files
- **Thread-safe logging** - Coordinated output from multiple workers
- Processing time varies by image complexity and shape count

### Customization
To modify parameters, edit the script's main section:
```python
if __name__ == '__main__':
    args = sys.argv[1:]
    nlist = [100, 300, 500]     # Test multiple shape counts
    alist = [64, 128, 192]      # Test multiple alpha values
    mlist = [1, 2, 3, 4, 5]     # Test different shape modes
    nworkers = 8                # Increase parallelism
    process(args[0], args[1], nlist, alist, mlist, nworkers)
```

## html.py - HTML Gallery Generator

### Purpose
Creates HTML comparison galleries showing original images alongside primitive art results with different parameters.

### Features
- **Side-by-side comparison** - Original vs primitive art results
- **Multiple shape counts** - Shows progression with 50, 100, 200 shapes
- **Multiple shape modes** - Compares triangles, ellipses, rotated rectangles
- **Responsive layout** - CSS styling for clean presentation

### Usage
```bash
python scripts/html.py input_folder/ output_folder/ > gallery.html
```

### Expected File Structure
The script expects files generated by a specific naming convention:
```
output_folder/
├── image1.50.128.4.1.png     # 50 triangles, alpha 128, mode 1
├── image1.100.128.4.1.png    # 100 triangles, alpha 128, mode 1
├── image1.200.128.4.1.png    # 200 triangles, alpha 128, mode 1
├── image1.50.128.4.3.png     # 50 ellipses, alpha 128, mode 3
├── image1.100.128.4.3.png    # 100 ellipses, alpha 128, mode 3
└── ...
```

### File Naming Convention
Format: `{name}.{shapes}.{alpha}.{workers}.{mode}.png`
- `name` - Base image name (without extension)
- `shapes` - Number of shapes (50, 100, 200)
- `alpha` - Alpha value (128)
- `workers` - Worker count (4)
- `mode` - Shape mode (1=triangles, 3=ellipses, 5=rotated rectangles)

### HTML Output Structure
```html
<table>
  <tr>
    <th>original</th>
    <th>50 shapes</th>
    <th>100 shapes</th>
    <th>200 shapes</th>
  </tr>
  <tr>
    <td><img src="input/image1.jpg"></td>
    <td><img src="output/image1.50.128.4.1.png"></td>
    <td><img src="output/image1.100.128.4.1.png"></td>
    <td><img src="output/image1.200.128.4.1.png"></td>
  </tr>
  <!-- Repeats for each image and shape mode -->
</table>
```

### Shape Modes Displayed
- **Mode 1**: Triangles
- **Mode 3**: Ellipses  
- **Mode 5**: Rotated rectangles

### CSS Styling
- **Image width**: Fixed at 400px for consistent comparison
- **Clean layout**: Minimal borders and spacing
- **Sans-serif font**: Modern, readable typography
- **Responsive design**: Adapts to different screen sizes

## Complete Workflow Example

### 1. Prepare Input Images
```bash
mkdir input_images/
# Copy your .jpg/.png files to input_images/
```

### 2. Run Batch Processing
```bash
python scripts/process.py input_images/ output_results/
```

This creates:
```
output_results/
├── photo1/
│   ├── 0.500.png
│   ├── 1.500.png
│   ├── 3.500.png
│   └── 5.500.png
└── photo2/
    ├── 0.500.png
    ├── 1.500.png
    ├── 3.500.png
    └── 5.500.png
```

### 3. Generate HTML Gallery
**Note**: The current `html.py` expects a different file naming convention than what `process.py` generates. For the HTML generator to work, you would need to either:

**Option A**: Modify `process.py` to use the expected naming:
```python
out_name = '%s.%d.%d.4.%d.png' % (base, n, a, m)  # name.shapes.alpha.workers.mode.png
```

**Option B**: Modify `html.py` to match `process.py` output:
```python
path = '%s/%d.%d.png' % (name, m, n)  # Match process.py structure
```

**Option C**: Use with compatible file structure:
```bash
python scripts/html.py input_images/ flat_output/ > gallery.html
```

## Use Cases

### Research and Analysis
- **Algorithm comparison** - Test different primitive modes on same images
- **Parameter tuning** - Find optimal shape counts for different image types
- **Dataset generation** - Create training data for machine learning models

### Art and Design
- **Style exploration** - Compare artistic effects of different primitive types
- **Portfolio creation** - Generate galleries of primitive art variations
- **Client presentations** - Show multiple options for commissioned work

### Performance Testing
- **Benchmark different parameters** - Measure processing time vs quality trade-offs
- **Parallel processing validation** - Test multi-threading performance
- **Memory usage analysis** - Monitor resource consumption with large batches

## Technical Notes

### Dependencies
- **Python 2.7** (legacy code)
- **Threading support** - Uses Python's threading module
- **Subprocess execution** - Calls primitive binary via shell

### Limitations
- **Python 2.7 only** - Uses legacy `Queue` and `xrange`
- **Shell dependency** - Requires `primitive` binary in PATH
- **File naming mismatch** - Scripts expect different naming conventions
- **No error recovery** - Failed jobs don't retry automatically

### Performance Considerations
- **I/O bound operations** - Disk access can be bottleneck
- **Memory usage** - Multiple concurrent processes increase RAM usage
- **CPU utilization** - Scales with `nworkers` parameter
- **Storage requirements** - Output files can be large with high shape counts

## Troubleshooting

### Common Issues
1. **Missing primitive binary** - Ensure `primitive` is compiled and in PATH
2. **Permission errors** - Check read/write permissions on folders
3. **Memory issues** - Reduce `nworkers` for large images or limited RAM
4. **File naming problems** - Verify input/output naming conventions match expectations

### Debug Tips
- **Test with small datasets** first
- **Monitor system resources** during batch processing
- **Check individual primitive commands** manually if jobs fail
- **Verify file paths** are absolute or relative to script location